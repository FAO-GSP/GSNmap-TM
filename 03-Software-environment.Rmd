# Setting-up the software environment

This chapter provides an overview on the software required to map soil nutrients and associated soil properties. The tools are open source and can be downloaded and installed by users following the steps that are described here. The instructions given are for Microsoft Windows operational systems. Instructions for other operational systems (e.g. Linux Flavours, MacOS) can be found through free online resources.

## Use of R, RStudio and R Packages

**R** is a language and environment for statistical computing created in 1992. It provides a wide variety of statistical (e.g. linear modeling, statistical tests, time-series, classification, clustering, etc.) and graphical methods, and has been constantly extended by an exceptionally active user community. 

### Obtaining and installing R

Installation files and instructions can be downloaded from the Comprehensive R Archive Network (CRAN).

1. Go to the following link https://cran.r-project.org/ to download and install **R**. 
2. Pick an installation file for your operational system.
3. Choose the "*base*" distribution of R (particularly if it is the first time you install **R**).
4. Download the R installation file and open the file on your device.
5. Follow the installation instructions.

### Obtaining and installing RStudio

Beginners will find it very hard to start using **R** because it has no Graphical User Interface (GUI). There are some GUIs which offer some of the functionality of **R**. **RStudio** makes **R** easier to use. It includes a code editor, debugging and visualization tools. Similar steps need to be followed to install **RStudio**.

1. Go to https://www.rstudio.com/products/rstudio/download/ to download and install **RStudio**'s open source edition.
2. On the download page, *RStudio Desktop, Open Source License* option should be selected.
3. Pick an installation file for your platform.
4. Follow the installation instruction on your local device.

```{r, echo = FALSE, fig.cap = "R Studio interface."}
#settings needed for pdf-document: fig.width = 7, out.width = "12cm"
knitr::include_graphics("images/2_RStudio-interface.png")
```


The **RStudio** interface is structured by four compartments (see Fig. 2.1). The code editor is located in the upper left. Scripts that contain codes are displayed here. New scripts can be opened by clicking on the left most *New* button in the quick access tool bar (highlighted in green). Lines of code can be executed by clickinig on *Run* (highlighted in blue) or by pressing *ctrl + enter* on your keyboard.
The output of scripts or lines of code that are executed is displayed in the window below the code editor: the console (bottom left). This part of the interface corresponds to the **R** software that were installed previously. 
When working in **R**, it is central to work with so-called objects (for instance vectors, dataframes or matrices). These objects are saved in the global environment that is displayed in the top right panel.
Finally, the **R** software offers a broad range of powerful tools for visualisation purposes. Graphs or maps that are generated by scripts/codes, are displayed in the bottom right panel.

### Getting started with R	

* **R** manuals:                  http://cran.r-project.org/manuals.html
* Contributed documentation:      http://cran.r-project.org/other-docs.html
* Quick-**R**:                    http://www.statmethods.net/index.html
* Stackoverflow **R** community:  https://stackoverflow.com/questions/tagged/r 

## R packages

When you download **R**, you get the basic **R** system which implements the **R** language. **R** becomes more useful with the large collection of packages that extend the basic functionality of it. **R** packages are developed by the **R** community.

refer to: 
  - *tidyverse* book (R for data science)
  - *caret* (broad range of statistical learning functions)
  - *R spatial*: https://rspatial.org/ (R packages for spatial data operations)

The primary source for **R** packages is [CRANâ€™s](https://cran.r-project.org/) official website, where currently about 12,000 available packages are listed. For spatial applications, various packages are available. You can obtain information about the available packages directly on CRAN with the `available.packages()` function. The function returns a matrix of details corresponding to packages currently available at one or more repositories. An easier way to browse the list of packages is using the [*Task Views*](https://cran.r-project.org/web/views/) link, which groups together packages related to a given topic. 

Packages come along with extensive documentation that is very helpful to understand and solve error messages. To access information on functions or packages, type "?[Package or Function name]" in the console. The information on the package and/or function can then be accessed in the bottom right panel under "Help" (see Fig. 2.1). In addition to that, the *R documentation* website (https://www.rdocumentation.org/) provides more extensive help and gives clear overviews on all functions comprised in a certain package.

## GEE - google earth engine

- general info

```{r, echo = FALSE, fig.cap = "Google Earth Engine code editor."}
#settings needed for pdf-document: fig.width = 7, out.width = "12cm"
knitr::include_graphics("images/2.1_GEE_codeeditor.png")
```


- upload assets to GEE 

```{r, echo = FALSE, fig.cap = "Select files and filetype to be uploaded as GEE assets."}
#settings needed for pdf-document: fig.width = 7, out.width = "12cm"
knitr::include_graphics("images/2.2_upload-assets-1.png")
```


```{r, echo = FALSE, fig.cap = "Upload interface."}
#settings needed for pdf-document: fig.width = 7, out.width = "12cm"
knitr::include_graphics("images/2.2_upload-assets-2.png")
```

- Explain how to import uploaded assets (?) ...

## rgee - Extension to use google earth engine in R
The rgee package enables users to interact with the GEE servers using the R language. The package makes use of the Python language to interact with GEE. The package can be downloaded easily either directly from the GitHub repository or via CRAN.

```{r, eval = F}

# Source: https://yabellini.github.io/curso_rgee/index.html
# Yanina Bellini Saibene

#install.packages('remotes')
# remotes::install_github("r-spatial/rgee")
```

To be able to interact with the GEE via Python, it is necessary to install certain R packages but also the so-called "Miniconda" commmand prompt which acts as Python interpreter mediating between R and GEE. The 'ee_install()' function automatically downloads and install all the software that is needed.

```{r}
# load rgee package and install dependencies
library(rgee)
# ee_install() # installs miniconda
```

Once the dependencies are installed, it is necessary to initialize rgee by providing the user credentials of our GEE account. The ee_Initialize command must be run every time we want to use rgee.

```{r}
# Initialize Google Earth Engine! (you need to create a user account)
# ee_Initialize()


# Useful functions

#ee_check() # check the dependencies that do not belong to R
#ee_clean_credentials() # to remove the user credentials
#ee_clean_pyenv() # Delete variables of the system

```

